name: Test npm setup

on:
  workflow_dispatch:

jobs:
  test-npm:
    name: Test npm configuration
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: List files in root
        run: |
          echo "=== Files in repository root ==="
          ls -la
          echo "=== Looking for lock files ==="
          find . -name "*lock*" -type f
          echo "=== Package.json content ==="
          cat package.json | head -10
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Verify npm setup
        run: |
          echo "Node version: $(node --version)"
          echo "npm version: $(npm --version)"
          echo "Package manager in package.json:"
          cat package.json | grep packageManager || echo "No packageManager field found"

      - name: Install dependencies
        run: npm ci

      - name: Success
        run: echo "npm setup working correctly!"